---
layout: default
---

# Chương 7, Mất quá nhiều thời gian để tạo ra một sự thay đổi

Mất bao lâu để thực hiện thay đổi? Câu trả lời sẽ rất rộng. Với các dự án có code tệ hại không rõ ràng, nhiều thay đổi cần thời gian khá dài. Chúng ta phải tìm hiểu code, hiểu tất cả các nhánh của một thay đổi và sau đó thực hiện thay đổi. Ở những vùng code rõ ràng hơn, việc này có thể rất nhanh, nhưng ở những vùng thực sự rắc rối, có thể mất rất nhiều thời gian. Một số nhóm có thể tồi tệ hơn nhiều so với những nhóm khác. Đối với họ, ngay cả những thay đổi đơn giản nhất cũng mất nhiều thời gian để thực hiện. Mọi người trong nhóm đó có thể tìm hiểu xem họ cần thêm tính năng nào, hình dung chính xác nơi thực hiện thay đổi, truy cập vào code và thực hiện thay đổi trong năm phút và vẫn không thể hoàn thành thay đổi của họ trong vài giờ.

Hãy xem xét các lý do và một số giải pháp khả thi

## Hiểu biết

Khi số lượng code trong một dự án tăng lên, nó sẽ dần vượt qua sự hiểu biết. Thời gian cần thiết để tìm ra những gì cần thay đổi liên tục tăng lên.

Một phần của điều này là không thể tránh khỏi. Khi thêm code vào một hệ thống, chúng ta có thể thêm vào các lớp, phương thức, hàm hiện có hoặc có thể tạo mới. Trong cả hai trường hợp, sẽ mất một thời gian để tìm ra hướng thay đổi nếu chúng ta không quen thuộc với bối cảnh.

Tuy nhiên, có một điểm khác biệt chính giữa hệ thống được bảo trì tốt và hệ thống kế thừa. Trong một hệ thống được bảo trì tốt, có thể mất một lúc để tìm ra cách thực hiện thay đổi, nhưng khi bạn đã có cách thực hiện, nó thường dễ dàng và bạn sẽ cảm thấy thoải mái hơn nhiều với hệ thống. Trong một hệ thống kế thừa, có thể mất nhiều thời gian hơn để tìm ra những việc cần làm và cách thay đổi cũng khó khăn. Bạn cũng có thể cảm thấy mình chưa học được nhiều điều ngoài sự hiểu biết hạn hẹp mà bạn phải đạt được để thực hiện thay đổi. Trong trường hợp xấu nhất, có vẻ như không có đủ thời gian để hiểu mọi thứ bạn cần làm để tạo ra sự thay đổi, bạn phải mù quáng bắt đầu thay đổi, và hy vọng rằng sẽ có thể giải quyết tất cả vấn đề mà bạn gặp phải.

Các hệ thống được chia thành các phần nhỏ, được đặt tên rõ ràng, dễ hiểu giúp làm việc nhanh hơn. Nếu sự hiểu biết là một vấn đề lớn đối với dự án của bạn, hãy xem _Chương 16, Tôi không hiểu code đủ rõ để thay đổi nó_ và _Chương 17, Ứng dụng của tôi không có kiến trúc_, để có một số ý tưởng về cách tiến hành.

## Độ trễ

Các thay đổi thường mất nhiều thời gian vì một lý do rất phổ biến khác: độ trễ. Độ trễ là khoảng thời gian giữa một thay đổi đang được thực hiện và thời điểm nhận được phản hồi thực sự về thay đổi đó. Tại thời điểm viết bài này, tàu thám hiểm Sao Hỏa - Spirit - đang di chuyển trên bề mặt sao Hỏa để chụp ảnh. Mất khoảng bảy phút để tín hiệu đi từ Trái đất đến Sao Hỏa. May mắn là Spirit có một số phần mềm hướng dẫn tích hợp giúp nó tự di chuyển. Hãy tưởng tượng sẽ như thế nào khi lái thủ công từ Trái đất. Bạn vận hành các nút điều khiển và tìm ra 14 phút sau xe tự hành đã di chuyển được bao xa. Sau đó, bạn quyết định những gì bạn muốn làm tiếp theo, thực hiện nó và đợi thêm 14 phút để tìm hiểu điều gì đã xảy ra. Nó có vẻ không hiệu quả một cách lố bịch, phải không? Tuy nhiên, khi nghĩ lại, đó chính xác là cách mà hầu hết chúng ta làm việc hiện nay khi phát triển phần mềm. Chúng ta thực hiện một số thay đổi, bắt đầu dựng và sau đó tìm hiểu điều gì đã xảy ra sau đó. Thật không may, chúng ta không có phần mềm biết cách điều hướng xung quanh các chướng ngại vật trong quá trình dựng, chẳng hạn như lỗi kiểm thử. Thay vào đó, những gì chúng ta cố gắng làm là gộp một loạt các thay đổi và thực hiện tất cả chúng cùng một lúc để chúng ta không phải dựng quá thường xuyên. Nếu những thay đổi của chúng ta là tốt, sẽ có cải thiện, mặc dù chậm như xe tự hành trên sao Hỏa. Nếu gặp chướng ngại vật, chúng ta sẽ đi chậm hơn.

Điều đáng buồn về cách làm việc này là trong hầu hết các ngôn ngữ, nó hoàn toàn không cần thiết. Đó hoàn toàn là một sự lãng phí thời gian. Trong hầu hết các ngôn ngữ chính thống, bạn luôn có thể phá vỡ phụ thuộc theo cách cho phép bạn biên dịch lại và chạy kiểm thử đối với bất kỳ code nào bạn đang làm việc trong vòng chưa đầy 10 giây. Nếu một nhóm thực sự có động lực, các thành viên của nhóm có thể giảm tốc độ xuống dưới năm giây, trong hầu hết các trường hợp. Kết quả là: Bạn sẽ có thể biên dịch mọi lớp hoặc mô-đun trong hệ thống của mình một cách riêng biệt với các lớp hoặc mô-đun khác và trong kiểm thử khai thác của chính nó. Khi có điều đó, bạn có thể nhận được phản hồi rất nhanh và điều đó sẽ giúp quá trình phát triển diễn ra nhanh hơn.

Tâm trí con người có một số đặc điểm thú vị. Nếu chúng ta phải thực hiện một nhiệm vụ ngắn (khoảng 5-10 giây) và chúng ta chỉ có thể bước một bước mỗi phút, chúng ta thường thực hiện rồi tạm dừng. Nếu chúng ta phải thực hiện một số công việc để tìm ra những việc cần làm ở bước tiếp theo, chúng ta bắt đầu lập kế hoạch. Sau khi lập kế hoạch, tâm trí chúng ta lang thang cho đến khi chúng ta có thể thực hiện bước tiếp theo. Nếu chúng ta rút ngắn thời gian giữa các bước xuống từ một phút xuống còn vài giây, chất lượng của công việc trí óc sẽ khác đi. Chúng ta có thể sử dụng thông tin phản hồi để thử các phương pháp một cách nhanh chóng. Công việc của chúng ta trở nên giống như lái xe hơn là chờ đợi ở trạm xe buýt. Sự tập trung của chúng ta cao hơn bởi vì chúng ta không liên tục chờ đợi cơ hội tiếp theo để làm điều gì đó. Quan trọng nhất, lượng thời gian mà chúng ta cần để nhận ra và sửa lỗi sẽ ít hơn nhiều.

Điều gì khiến chúng ta không thể làm việc theo cách này mọi lúc? Một số người có thể. Những người lập trình bằng ngôn ngữ thông dịch thường có thể nhận được phản hồi gần như tức thời khi họ làm việc. Đối với phần còn lại, những người làm việc với các ngôn ngữ cần biên dịch, trở ngại chính là sự phụ thuộc, nhu cầu biên dịch thứ gì đó mà chúng ta không quan tâm chỉ vì chúng ta muốn biên dịch thứ khác.

## Phá vỡ sự phụ thuộc

Sự phụ thuộc có thể có vấn đề, nhưng may mắn thay, chúng ta có thể phá vỡ chúng. Trong code hướng đối tượng, bước đầu tiên thường là cố gắng khởi tạo các lớp mà chúng ta cần trong kiểm thử khai thác. Trong những trường hợp đơn giản nhất, chúng ta có thể làm điều này chỉ bằng cách nhập hoặc liệt kê phần khai báo của các lớp phụ thuộc. Trong những trường hợp khó hơn, hãy thử các kỹ thuật trong _Chương 9, Tôi không thể đưa lớp này vào kiểm thử khai thác_. Khi bạn có thể tạo một đối tượng của một lớp trong kiểm thử khai thác, bạn có thể sẽ phải phá vỡ các phần phụ thuộc khác nếu bạn muốn thử nghiệm riêng biệt các phương thức. Trong những trường hợp đó, hãy xem _Chương 10, Tôi không thể đưa lớp này vào kiểm thử khai thác_.

Nói chung, khi bạn có một lớp cần thay đổi trong kiểm thử khai thác, bạn sẽ được hưởng lợi khi vòng lặp chỉnh sửa - biên dịch - liên kết - kiểm tra diễn ra nhanh. Thông thường, chi phí thực thi đối với hầu hết các phương thức tương đối thấp so với chi phí của các phương thức mà chúng gọi, đặc biệt là gọi đến tài nguyên bên ngoài như cơ sở dữ liệu, phần cứng hoặc cơ sở hạ tầng truyền thông. Ngoài ra là trường hợp phương thức có nhiều tính toán. Những kỹ thuật mà tôi đã vạch ra trong _Chương 22 - Tôi Cần Thay đổi một Phương thức "Quái vật" và Tôi Không thể Viết Kiểm thử cho Nó_, có thể hữu ích.

Trong nhiều trường hợp, sự thay đổi diễn ra đơn giản, nhưng thường thì những người làm việc với code kế thừa đã dừng lại ngay từ bước đầu tiên: cố gắng đưa một lớp vào kiểm thử khai thác. Đây có thể là một nỗ lực lớn với một số hệ thống. Một số lớp thậm chí rất lớn; những cái khác có quá nhiều phụ thuộc đến mức chúng dường như quá tải hoàn toàn các chức năng mà bạn muốn làm việc. Trong những trường hợp như vậy, bạn nên xem liệu có thể cắt bỏ một đoạn code lớn hơn và đưa nó vào kiểm thử hay không. Xem _Chương 12, Tôi cần thực hiện nhiều thay đổi trong một khu vực. Tôi có phải phá vỡ các phụ thuộc của tất cả các lớp liên quan không?_ Chương đó chứa một tập hợp các kỹ thuật có thể sử dụng để tìm các _điểm chặn (180)_, những nơi mà việc viết kiểm thử dễ dàng hơn.

Trong phần còn lại của chương này, tôi mô tả cách bạn có thể thay đổi tổ chức code của mình để giúp việc dựng dễ dàng hơn.

